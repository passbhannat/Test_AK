  
ALTER PROC [dbo].[crystal_ReceiptPrintBarCode]
@DocKey Varchar(20)
AS
IF OBJECT_ID('TEMPDB..#TEMP') IS NOT NULL DROP TABLE #TEMP

DECLARE @ItemCode Varchar(40)
DECLARE @ManSerial Varchar(1)
DECLARE @ManBatch Varchar(1)

SET @ItemCode = (SELECT TOP 1 ItemCode FROM IGN1 WHERE DocEntry = @DocKey)

SET @ManSerial = (SELECT ManSerNum FROM OITM WHERE ItemCode = @ItemCode)
SET @ManBatch = (SELECT ManBtchNum FROM OITM WHERE ItemCode = @ItemCode)

IF @ManBatch = 'Y'
BEGIN
	SELECT T2.DistNumber,
	 T1.ItemCode,T3.ItemName,T0.Quantity ,T2.MnfSerial,T2.DistNumber [Barcode],T2.InDate,T3.InvntryUom
	 FROM    ITL1 T0
	INNER JOIN	OITL T1 ON T0.LogEntry = T1.LogEntry
	INNER JOIN	OBTN T2 ON T0.ItemCode = T2.ItemCode and T0.SysNumber = T2.SysNumber
	INNER JOIN	OITM T3 ON T0.ItemCode = T3.ItemCode 
	WHERE T1.ApplyEntry = @DocKey
	AND T1.ApplyType = '59'
END

IF @ManSerial = 'Y'
BEGIN
	SELECT T2.DistNumber,
	 T1.ItemCode,T3.ItemName,T0.Quantity ,T2.MnfSerial,T2.DistNumber [Barcode],T2.InDate,T3.InvntryUom
	 FROM    ITL1 T0
	INNER JOIN	OITL T1 ON T0.LogEntry = T1.LogEntry
	INNER JOIN	OSRN T2 ON T0.ItemCode = T2.ItemCode and T0.SysNumber = T2.SysNumber
	INNER JOIN	OITM T3 ON T0.ItemCode = T3.ItemCode 
	WHERE T1.ApplyEntry = @DocKey
	AND T1.ApplyType = '59'
END

-- SELECT * 
--FROM #TEMP r
--CROSS APPLY dbo.NumbersTable(1,r.NoofPackages,1) --n
--ORDER BY r.U_ItemCode
GO


